[gd_scene load_steps=25 format=2]

[ext_resource path="res://addons/Shader Nodes/custom/nodes/voronoi_texture.gd" type="Script" id=1]

[sub_resource type="SphereMesh" id=1]
radius = 500.0
height = 1000.0

[sub_resource type="VisualShaderNodeColorConstant" id=12]
constant = Color( 0.985145, 0.874548, 0.0149657, 1 )

[sub_resource type="VisualShaderNodeColorConstant" id=13]
constant = Color( 0.963433, 0.661021, 0.032746, 1 )

[sub_resource type="VisualShaderNodeScalarConstant" id=14]
constant = 5.0

[sub_resource type="VisualShaderNodeScalarConstant" id=15]
constant = 5.0

[sub_resource type="VisualShaderNodeInput" id=16]
input_name = "uv"

[sub_resource type="VisualShaderNodeScalarConstant" id=17]
constant = 1.0

[sub_resource type="VisualShaderNodeScalarConstant" id=18]

[sub_resource type="VisualShaderNodeInput" id=19]
input_name = "time"

[sub_resource type="VisualShaderNodeScalarOp" id=20]
default_input_values = [ 0, 0.0, 1, 0.2 ]
operator = 2

[sub_resource type="VisualShaderNodeScalarUniform" id=21]
uniform_name = "CellSpeed"

[sub_resource type="VisualShaderNodeColorUniform" id=2]
uniform_name = "BaseColor"

[sub_resource type="VisualShaderNodeVectorOp" id=22]
output_port_for_preview = 0

[sub_resource type="VisualShaderNodeVectorOp" id=23]
output_port_for_preview = 0
operator = 2

[sub_resource type="VisualShaderNodeVectorOp" id=24]
output_port_for_preview = 0

[sub_resource type="VisualShaderNodeScalarConstant" id=25]
constant = 1.0

[sub_resource type="VisualShaderNodeScalarOp" id=26]
operator = 5

[sub_resource type="VisualShaderNodeCustom" id=5]
output_port_for_preview = 0
initialized = true
script = ExtResource( 1 )

[sub_resource type="VisualShaderNodeScalarUniform" id=6]
uniform_name = "CellDensity"

[sub_resource type="VisualShaderNodeScalarUniform" id=8]
uniform_name = "SolarFlare"

[sub_resource type="VisualShaderNodeColorUniform" id=9]
uniform_name = "CellColor"

[sub_resource type="VisualShader" id=3]
code = "shader_type spatial;
render_mode specular_schlick_ggx;

uniform float CellSpeed;
uniform float CellDensity;
uniform float SolarFlare;
uniform vec4 CellColor : hint_color;
uniform vec4 BaseColor : hint_color;


// VoronoiTexture

		/* Generic Noise 3 by PatricioGonzalezVivo
		@ https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83
		|----------------------------------------------------------------*/
		vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
		vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}

		float noise3(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);

			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);

			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);

			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));

			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);

			return o4.y * d.y + o4.x * (1.0 - d.y);
		}


		/* === Based on The Blender Foundation shader
		@ https://git.blender.org/gitweb/gitweb.cgi/blender.git/blob/HEAD:/source/blender/gpu/shaders/material/gpu_shader_material_tex_voronoi.glsl
		_________________________________________________________________________________________________________________________________________*/

		/*_ Voronoi func _*/

		float smoothVoronoi(vec3 coords, float scale, float randomness, float smoothness) {
			randomness = clamp(randomness, 0.0, 1.0);
			smoothness = clamp(smoothness/2.0,  0.0, 0.5);
			vec3 cell_position = floor(coords * scale);
			vec3 local_position = (coords * scale) - floor(coords * scale);

			float smooth_distance = 8.0;
			vec3 smooth_position = vec3(0.0);

			for (int k = -2; k <= 2; k++) {
				for (int j = -2; j <= 2; j++) {
					for (int i = -2; i <= 2; i++) {
						
						vec3 cell_offset = vec3(float(i), float(j), float(k));
						vec3 point_position = cell_offset + noise3(cell_position + cell_offset) * randomness;
						float distance_to_point = distance(point_position, local_position);
						float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (smooth_distance - distance_to_point) / smoothness);
						float correction_factor = smoothness * h * (1.0 - h);
						smooth_distance = mix(smooth_distance, distance_to_point, h) - correction_factor;

					}
				}
			}
			return smooth_distance;
		}
	

void vertex() {
// Output:0

}

void fragment() {
// Input:14
	vec3 n_out14p0 = vec3(UV, 0.0);

// Input:17
	float n_out17p0 = TIME;

// ScalarUniform:19
	float n_out19p0 = CellSpeed;

// ScalarOp:18
	float n_out18p0 = n_out17p0 * n_out19p0;

// VectorOp:20
	vec3 n_out20p0 = n_out14p0 + vec3(n_out18p0);

// ScalarUniform:4
	float n_out4p0 = CellDensity;

// Scalar:15
	float n_out15p0 = 1.000000;

// Scalar:16
	float n_out16p0 = 0.000000;

// VoronoiTexture:3
	float n_out3p0;
	{
		n_out3p0 = smoothVoronoi(n_out20p0, n_out4p0, n_out15p0, n_out16p0);
	}

// ScalarUniform:6
	float n_out6p0 = SolarFlare;

// ScalarOp:25
	float n_out25p0 = pow(n_out3p0, n_out6p0);

// ColorUniform:7
	vec3 n_out7p0 = CellColor.rgb;
	float n_out7p1 = CellColor.a;

// VectorOp:21
	vec3 n_out21p0 = vec3(n_out25p0) * n_out7p0;

// ColorUniform:2
	vec3 n_out2p0 = BaseColor.rgb;
	float n_out2p1 = BaseColor.a;

// VectorOp:23
	vec3 n_out23p0 = n_out21p0 + n_out2p0;

// Output:0
	EMISSION = n_out23p0;

}

void light() {
// Output:0

}
"
graph_offset = Vector2( -141.167, 170.75 )
nodes/fragment/0/position = Vector2( 680, 140 )
nodes/fragment/2/node = SubResource( 2 )
nodes/fragment/2/position = Vector2( -80, 360 )
nodes/fragment/3/node = SubResource( 5 )
nodes/fragment/3/position = Vector2( -500, 60 )
nodes/fragment/4/node = SubResource( 6 )
nodes/fragment/4/position = Vector2( -760, 160 )
nodes/fragment/6/node = SubResource( 8 )
nodes/fragment/6/position = Vector2( -540, 320 )
nodes/fragment/7/node = SubResource( 9 )
nodes/fragment/7/position = Vector2( -380, 400 )
nodes/fragment/10/node = SubResource( 12 )
nodes/fragment/10/position = Vector2( -40, 480 )
nodes/fragment/11/node = SubResource( 13 )
nodes/fragment/11/position = Vector2( -340, 520 )
nodes/fragment/12/node = SubResource( 14 )
nodes/fragment/12/position = Vector2( -560, 380 )
nodes/fragment/13/node = SubResource( 15 )
nodes/fragment/13/position = Vector2( -760, 220 )
nodes/fragment/14/node = SubResource( 16 )
nodes/fragment/14/position = Vector2( -1300, 60 )
nodes/fragment/15/node = SubResource( 17 )
nodes/fragment/15/position = Vector2( -760, 280 )
nodes/fragment/16/node = SubResource( 18 )
nodes/fragment/16/position = Vector2( -760, 340 )
nodes/fragment/17/node = SubResource( 19 )
nodes/fragment/17/position = Vector2( -1520, -220 )
nodes/fragment/18/node = SubResource( 20 )
nodes/fragment/18/position = Vector2( -1320, -120 )
nodes/fragment/19/node = SubResource( 21 )
nodes/fragment/19/position = Vector2( -1540, 40 )
nodes/fragment/20/node = SubResource( 22 )
nodes/fragment/20/position = Vector2( -1060, -80 )
nodes/fragment/21/node = SubResource( 23 )
nodes/fragment/21/position = Vector2( -60, 140 )
nodes/fragment/23/node = SubResource( 24 )
nodes/fragment/23/position = Vector2( 120, 180 )
nodes/fragment/24/node = SubResource( 25 )
nodes/fragment/24/position = Vector2( -1540, 120 )
nodes/fragment/25/node = SubResource( 26 )
nodes/fragment/25/position = Vector2( -280, 180 )
nodes/fragment/connections = PoolIntArray( 16, 0, 3, 3, 17, 0, 18, 0, 18, 0, 20, 1, 20, 0, 3, 0, 15, 0, 3, 2, 21, 0, 23, 0, 25, 0, 21, 0, 3, 0, 25, 0, 23, 0, 0, 5, 19, 0, 18, 1, 4, 0, 3, 1, 6, 0, 25, 1, 7, 0, 21, 1, 2, 0, 23, 1, 14, 0, 20, 0 )

[sub_resource type="ShaderMaterial" id=4]
shader = SubResource( 3 )
shader_param/CellSpeed = 0.1
shader_param/CellDensity = 50.0
shader_param/SolarFlare = 5.0
shader_param/CellColor = Color( 0.952941, 0.556863, 0.0431373, 1 )
shader_param/BaseColor = Color( 0.94902, 0.905882, 0.623529, 1 )

[node name="Sun" type="MeshInstance"]
mesh = SubResource( 1 )
material/0 = SubResource( 4 )
